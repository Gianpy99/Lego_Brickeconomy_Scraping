<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š LEGO Analytics Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Enhanced responsive styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --text-color: #2c3e50;
            --light-bg: #f8fafc;
            --card-shadow: 0 4px 16px rgba(44, 62, 80, 0.08);
            --border-radius: 12px;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }
        
        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Navigation Bar */
        .navigation-bar {
            display: flex;
            justify-content: center;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            gap: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .nav-link:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .nav-link.active {
            background: var(--accent-color);
            color: white;
        }
        
        .nav-link i {
            font-size: 1.1em;
        }
        
        /* Dashboard grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-card {
            background: rgba(255,255,255,0.97);
            border-radius: var(--border-radius);
            padding: 28px 24px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .chart-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(44,62,80,0.15);
        }
        
        .chart-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .chart-header h3 {
            color: var(--text-color);
            margin: 0;
            font-size: 1.3rem;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Summary stats */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.97);
            border-radius: var(--border-radius);
            padding: 24px;
            text-align: center;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--accent-color);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Table styles */
        .data-table {
            background: rgba(255,255,255,0.97);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            color: var(--text-color); /* testo scuro per tabelle */
        }
        
        .table-header {
            background: var(--accent-color);
            color: white;
            padding: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .table-content {
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
            color: var(--text-color); /* testo scuro nelle celle */
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--text-color);
        }
        
        tr:hover {
            background: #eaf0fa;
            background: #f8f9fa;
        }
        
        /* Filter controls */
        .filter-section {
            background: rgba(255,255,255,0.95);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: center;
        }
        
        .filter-select {
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-secondary {
            background: var(--light-bg);
            color: var(--text-color);
            border: 2px solid #e1e8ed;
        }
        
        .btn-primary {
            background: var(--accent-color);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255,255,255,0.8);
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> Analytics Dashboard</h1>
            <p>Comprehensive analysis of your LEGO collection data</p>
        </div>
        
        <!-- Navigation Bar -->
        <div class="navigation-bar">
            <a href="index.html" class="nav-link">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="sets.html" class="nav-link">
                <i class="fas fa-boxes"></i> Sets
            </a>
            <a href="minifigs.html" class="nav-link">
                <i class="fas fa-users"></i> Minifigures
            </a>
            <a href="matrix.html" class="nav-link">
                <i class="fas fa-th"></i> Matrix
            </a>
            <a href="analytics.html" class="nav-link active">
                <i class="fas fa-chart-line"></i> Analytics
            </a>
        </div>
        
        <!-- Summary Statistics -->
        <div class="summary-stats">
            <div class="stat-card">
                <div class="stat-number">52</div>
                <div class="stat-label">Total Sets</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">155</div>
                <div class="stat-label">Total Minifigs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">563</div>
                <div class="stat-label">Avg Pieces</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">Â£52</div>
                <div class="stat-label">Avg Price</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">6</div>
                <div class="stat-label">Years Span</div>
            </div>
        </div>
        
        <!-- Filter Section -->
        <div class="filter-section">
            <h3><i class="fas fa-filter"></i> Dashboard Filters</h3>
            <div class="filter-grid">
                <select id="themeFilter" class="filter-select">
                    <option value="">All Themes</option>
                </select>
                <select id="yearFilter" class="filter-select">
                    <option value="">All Years</option>
                </select>
                <button class="btn btn-primary" onclick="updateCharts()">
                    <i class="fas fa-sync-alt"></i> Update Charts
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
        
        <!-- Dashboard Charts -->
        <div class="dashboard-grid">
            <!-- Sets by Theme Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <i class="fas fa-chart-pie" style="color: var(--accent-color);"></i>
                    <h3>Sets by Theme</h3>
                </div>
                <div class="chart-container">
                    <canvas id="themeChart"></canvas>
                </div>
            </div>
            
            <!-- Sets by Year Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <i class="fas fa-chart-bar" style="color: var(--success-color);"></i>
                    <h3>Sets by Release Year</h3>
                </div>
                <div class="chart-container">
                    <canvas id="yearChart"></canvas>
                </div>
            </div>
            
            <!-- Pieces Distribution -->
            <div class="chart-card">
                <div class="chart-header">
                    <i class="fas fa-chart-line" style="color: var(--warning-color);"></i>
                    <h3>Pieces Distribution</h3>
                </div>
                <div class="chart-container">
                    <canvas id="piecesChart"></canvas>
                </div>
            </div>
            
            <!-- Price Analysis -->
            <div class="chart-card">
                <div class="chart-header">
                    <i class="fas fa-chart-area" style="color: var(--danger-color);"></i>
                    <h3>Price Analysis</h3>
                </div>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Top Sets Table -->
        <div class="data-table">
            <div class="table-header">
                <i class="fas fa-trophy"></i>
                <span>Top Sets by Pieces</span>
            </div>
            <div class="table-content">
                <table>
                    <thead>
                        <tr>
                            <th>Set Code</th>
                            <th>Name</th>
                            <th>Pieces</th>
                            <th>Theme</th>
                            <th>Price (GBP)</th>
                        </tr>
                    </thead>
                    <tbody id="topSetsTable">
                        
            <tr>
                <td>10316</td>
                <td>10316 The Lord of the Rings Rivendell</td>
                <td>6,167</td>
                <td>Icons</td>
                <td>Â£429.99</td>
            </tr>
        
            <tr>
                <td>10333</td>
                <td>10333 The Lord of the Rings Barad-Dur</td>
                <td>5,471</td>
                <td>Icons</td>
                <td>Â£399.99</td>
            </tr>
        
            <tr>
                <td>10237</td>
                <td>10237 Tower of Orthanc</td>
                <td>2,359</td>
                <td>The Lord of the Rings</td>
                <td>Â£169.99</td>
            </tr>
        
            <tr>
                <td>9474</td>
                <td>9474 The Battle Of Helm's Deep</td>
                <td>1,368</td>
                <td>The Lord of the Rings</td>
                <td>Â£99.99</td>
            </tr>
        
            <tr>
                <td>10367</td>
                <td>10367 The Lord of the Rings Balrog Book Nook</td>
                <td>1,201</td>
                <td>Icons</td>
                <td>Â£109.99</td>
            </tr>
        
            <tr>
                <td>79018</td>
                <td>79018 The Lonely Mountain</td>
                <td>866</td>
                <td>The Hobbit</td>
                <td>Â£99.99</td>
            </tr>
        
            <tr>
                <td>79010</td>
                <td>79010 The Goblin King Battle</td>
                <td>841</td>
                <td>The Hobbit</td>
                <td>Â£79.99</td>
            </tr>
        
            <tr>
                <td>79014</td>
                <td>79014 Dol Guldur Battle</td>
                <td>797</td>
                <td>The Hobbit</td>
                <td>Â£69.99</td>
            </tr>
        
            <tr>
                <td>9473</td>
                <td>9473 The Mines of Moria</td>
                <td>776</td>
                <td>The Lord of the Rings</td>
                <td>Â£69.99</td>
            </tr>
        
            <tr>
                <td>79008</td>
                <td>79008 Pirate Ship Ambush</td>
                <td>756</td>
                <td>The Lord of the Rings</td>
                <td>Â£89.99</td>
            </tr>
        
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Special Statistics Section -->
        <div class="data-table">
            <div class="table-header">
                <i class="fas fa-star"></i>
                <span>Special Statistics</span>
            </div>
            <div class="table-content">
                <table>
                    <tbody>
                        <tr>
                            <td>Minifigure Ownership</td>
                            <td class="text-right" id="minifigOwnershipPercent">72%</td>
                        </tr>
                        <tr>
                            <td>Set with Most Minifigs</td>
                            <td class="text-right" id="setWithMostMinifigsName">Rivendell (12)</td>
                        </tr>
                        <tr>
                            <td>Most Expensive Minifig</td>
                            <td class="text-right" id="mostExpensiveMinifigName">Gollum (Â£39.99)</td>
                        </tr>
                        <tr>
                            <td>Most Expensive Set</td>
                            <td class="text-right" id="mostExpensiveSetName">Rivendell (Â£429.99)</td>
                        </tr>
                        <tr>
                            <td>Most Prolific Year</td>
                            <td class="text-right" id="mostProlificYearValue">2012 (21 sets)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Rare Minifigures Table -->
        <div class="data-table">
            <div class="table-header">
                <i class="fas fa-gem"></i>
                <span>Rare Minifigures</span>
            </div>
            <div class="table-content">
                <table>
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Set</th>
                        </tr>
                    </thead>
                    <tbody id="rareMinifigsTable">
                        
            <tr>
                <td>lor005</td>
                <td>Gollum</td>
                <td>9470 Shelob Attacks</td>
            </tr>
        
            <tr>
                <td>lor010</td>
                <td>Haldir</td>
                <td>9474 The Battle Of Helm's Deep</td>
            </tr>
        
            <tr>
                <td>lor021</td>
                <td>Grinnah</td>
                <td>79010 The Goblin King Battle</td>
            </tr>
        
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="footer">
            <!-- Top 10 Minifig Value -->
            <div class="data-table">
                <div class="table-header">
                    <i class="fas fa-user-astronaut"></i>
                    <span>Top 10 Minifig Value</span>
                </div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Value (Â£)</th>
                            </tr>
                        </thead>
                        <tbody id="topMinifigsTable"></tbody>
                    </table>
                </div>
            </div>
            <!-- Top 10 Set Value -->
            <div class="data-table">
                <div class="table-header">
                    <i class="fas fa-box"></i>
                    <span>Top 10 Set Value</span>
                </div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Value (â‚¬)</th>
                            </tr>
                        </thead>
                        <tbody id="topSetsValueTable"></tbody>
                    </table>
                </div>
            </div>
            <div class="footer">
                <a href="index.html" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Main
                </a>
            </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ...existing code...
            fetchTopValueTables();
        });

        async function fetchTopValueTables() {
            // Minifigs
            try {
                const minifigsResp = await fetch('/api/minifigs');
                let minifigs = [];
                if (minifigsResp.ok) {
                    minifigs = await minifigsResp.json();
                }
                const valueMinifigs = minifigs.filter(m => m.retail_price && !isNaN(parseFloat(m.retail_price)));
                valueMinifigs.sort((a, b) => parseFloat(b.retail_price) - parseFloat(a.retail_price));
                const top10 = valueMinifigs.slice(0, 10);
                const minifigsTable = document.getElementById('topMinifigsTable');
                minifigsTable.innerHTML = top10.map(m => `<tr><td>${m.code}</td><td>${m.name}</td><td>Â£${parseFloat(m.retail_price).toFixed(2)}</td></tr>`).join('');
            } catch (e) {
                document.getElementById('topMinifigsTable').innerHTML = '<tr><td colspan="3">Errore nel caricamento dati minifig</td></tr>';
            }
            // Sets
            try {
                const setsResp = await fetch('/api/sets');
                let sets = [];
                if (setsResp.ok) {
                    sets = await setsResp.json();
                }
                const valueSets = sets.filter(s => s.retail_price && !isNaN(parseFloat(s.retail_price)));
                valueSets.sort((a, b) => parseFloat(b.retail_price) - parseFloat(a.retail_price));
                const top10 = valueSets.slice(0, 10);
                const setsTable = document.getElementById('topSetsValueTable');
                setsTable.innerHTML = top10.map(s => `<tr><td>${s.code}</td><td>${s.name}</td><td>â‚¬${parseFloat(s.retail_price).toFixed(2)}</td></tr>`).join('');
            } catch (e) {
                document.getElementById('topSetsValueTable').innerHTML = '<tr><td colspan="3">Errore nel caricamento dati set</td></tr>';
            }
        }
        // Analytics data
        const analyticsData = {"total_sets": 52, "total_minifigs": 155, "avg_pieces": 563.2307692307693, "avg_price": 52.41183673469387, "years_span": 6, "theme_distribution": {"labels": ["The Hobbit", "The Lord of the Rings", "Gear", "Icons", "BrickHeadz", "Dimensions", "Games"], "values": [18, 15, 5, 4, 4, 4, 2]}, "year_distribution": {"labels": ["2012", "2013", "2014", "2015", "2023", "2024"], "values": [21, 14, 4, 4, 4, 3]}, "pieces_distribution": {"labels": ["0-100", "101-300", "301-500", "501-1000", "1000+"], "values": [16, 14, 10, 7, 5]}, "price_pieces_correlation": [{"x": 227.0, "y": 19.99}, {"x": 430.0, "y": 49.99}, {"x": 776.0, "y": 69.99}, {"x": 1368.0, "y": 99.99}, {"x": 366.0, "y": 39.99}, {"x": 2359.0, "y": 169.99}, {"x": 6167.0, "y": 429.99}, {"x": 5471.0, "y": 399.99}, {"x": 33.0, "y": 3.15}, {"x": 21.0, "y": 3.15}, {"x": 27.0, "y": 3.94}, {"x": 31.0, "y": 3.94}, {"x": 31.0, "y": 3.94}, {"x": 184.0, "y": 13.49}, {"x": 348.0, "y": 17.99}, {"x": 261.0, "y": 17.99}, {"x": 297.0, "y": 17.99}, {"x": 269.0, "y": 99.99}, {"x": 39.0, "y": 14.99}, {"x": 36.0, "y": 14.99}, {"x": 56.0, "y": 14.99}, {"x": 105.0, "y": 11.99}, {"x": 298.0, "y": 24.99}, {"x": 400.0, "y": 49.99}, {"x": 652.0, "y": 59.99}, {"x": 334.0, "y": 39.99}, {"x": 113.0, "y": 11.99}, {"x": 243.0, "y": 29.99}, {"x": 656.0, "y": 59.99}, {"x": 756.0, "y": 89.99}, {"x": 841.0, "y": 79.99}, {"x": 217.0, "y": 19.99}, {"x": 276.0, "y": 29.99}, {"x": 470.0, "y": 49.99}, {"x": 797.0, "y": 69.99}, {"x": 101.0, "y": 11.99}, {"x": 313.0, "y": 34.99}, {"x": 472.0, "y": 59.99}, {"x": 866.0, "y": 99.99}, {"x": 1201.0, "y": 109.99}, {"x": 394.0, "y": 24.99}, {"x": 338.0, "y": 29.99}, {"x": 83.0, "y": 11.99}, {"x": 257.0, "y": 29.99}], "top_sets": [{"lego_code": "10316", "official_name": "10316 The Lord of the Rings Rivendell", "pieces_num": 6167.0, "theme": "Icons", "retail_price_gbp": "Â£429.99"}, {"lego_code": "10333", "official_name": "10333 The Lord of the Rings Barad-Dur", "pieces_num": 5471.0, "theme": "Icons", "retail_price_gbp": "Â£399.99"}, {"lego_code": "10237", "official_name": "10237 Tower of Orthanc", "pieces_num": 2359.0, "theme": "The Lord of the Rings", "retail_price_gbp": "Â£169.99"}, {"lego_code": "9474", "official_name": "9474 The Battle Of Helm's Deep", "pieces_num": 1368.0, "theme": "The Lord of the Rings", "retail_price_gbp": "Â£99.99"}, {"lego_code": "10367", "official_name": "10367 The Lord of the Rings Balrog Book Nook", "pieces_num": 1201.0, "theme": "Icons", "retail_price_gbp": "Â£109.99"}, {"lego_code": "79018", "official_name": "79018 The Lonely Mountain", "pieces_num": 866.0, "theme": "The Hobbit", "retail_price_gbp": "Â£99.99"}, {"lego_code": "79010", "official_name": "79010 The Goblin King Battle", "pieces_num": 841.0, "theme": "The Hobbit", "retail_price_gbp": "Â£79.99"}, {"lego_code": "79014", "official_name": "79014 Dol Guldur Battle", "pieces_num": 797.0, "theme": "The Hobbit", "retail_price_gbp": "Â£69.99"}, {"lego_code": "9473", "official_name": "9473 The Mines of Moria", "pieces_num": 776.0, "theme": "The Lord of the Rings", "retail_price_gbp": "Â£69.99"}, {"lego_code": "79008", "official_name": "79008 Pirate Ship Ambush", "pieces_num": 756.0, "theme": "The Lord of the Rings", "retail_price_gbp": "Â£89.99"}]};
        
        // Chart instances
        let themeChart, yearChart, piecesChart, priceChart, possessionThemeChart;
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            populateFilters();
            renderSpecialStats();
        });
        
        function renderSpecialStats() {
            // Dummy data, replace with real data if available
            document.getElementById('ownershipPercent').textContent = '85%';
            document.getElementById('minifigOwnershipPercent').textContent = '72%';
            document.getElementById('mostCommonMinifigName').textContent = 'Frodo Baggins';
            document.getElementById('setWithMostMinifigsName').textContent = 'Rivendell (12)';
            document.getElementById('mostExpensiveMinifigName').textContent = 'Gollum (Â£39.99)';
            document.getElementById('mostExpensiveSetName').textContent = 'Rivendell (Â£429.99)';
            document.getElementById('mostProlificYearValue').textContent = '2012 (21 sets)';
            // Rare minifigs
            const rareMinifigs = [
                { code: 'lor005', name: 'Gollum', set: '9470 Shelob Attacks' },
                { code: 'lor010', name: 'Haldir', set: '9474 The Battle Of Helm\'s Deep' },
                { code: 'lor021', name: 'Grinnah', set: '79010 The Goblin King Battle' }
            ];
            const rareTable = document.getElementById('rareMinifigsTable');
            rareTable.innerHTML = rareMinifigs.map(m => `<tr><td>${m.code}</td><td>${m.name}</td><td>${m.set}</td></tr>`).join('');
        }
        
        function initializeCharts() {
            // Theme distribution chart
            const themeCtx = document.getElementById('themeChart').getContext('2d');
            themeChart = new Chart(themeCtx, {
                type: 'doughnut',
                data: {
                    labels: analyticsData.theme_distribution.labels,
                    datasets: [{
                        data: analyticsData.theme_distribution.values,
                        backgroundColor: [
                            '#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6',
                            '#1abc9c', '#34495e', '#f1c40f', '#e67e22', '#95a5a6'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Year distribution chart
            const yearCtx = document.getElementById('yearChart').getContext('2d');
            yearChart = new Chart(yearCtx, {
                type: 'bar',
                data: {
                    labels: analyticsData.year_distribution.labels,
                    datasets: [{
                        label: 'Sets Released',
                        data: analyticsData.year_distribution.values,
                        backgroundColor: '#2ecc71',
                        borderColor: '#27ae60',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Pieces distribution chart
            const piecesCtx = document.getElementById('piecesChart').getContext('2d');
            piecesChart = new Chart(piecesCtx, {
                type: 'line',
                data: {
                    labels: analyticsData.pieces_distribution.labels,
                    datasets: [{
                        label: 'Number of Sets',
                        data: analyticsData.pieces_distribution.values,
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Price analysis chart
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(priceCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Price vs Pieces',
                        data: analyticsData.price_pieces_correlation,
                        backgroundColor: '#e74c3c',
                        borderColor: '#c0392b'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Number of Pieces'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Price (GBP)'
                            }
                        }
                    }
                }
            });
            
            // Possession by Theme chart (dummy)
            const possessionThemeCtx = document.getElementById('possessionThemeChart').getContext('2d');
            possessionThemeChart = new Chart(possessionThemeCtx, {
                type: 'pie',
                data: {
                    labels: analyticsData.theme_distribution.labels,
                    datasets: [{
                        data: [12, 10, 4, 3, 2, 2, 1], // Dummy: sets owned per theme
                        backgroundColor: [
                            '#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6',
                            '#1abc9c', '#34495e', '#f1c40f', '#e67e22', '#95a5a6'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function populateFilters() {
            // Populate theme filter
            const themes = [...new Set(analyticsData.theme_distribution.labels)];
            const themeFilter = document.getElementById('themeFilter');
            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme;
                option.textContent = theme;
                themeFilter.appendChild(option);
            });
            
            // Populate year filter
            const years = analyticsData.year_distribution.labels;
            const yearFilter = document.getElementById('yearFilter');
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }
        
        function updateCharts() {
            // Placeholder for chart updates based on filters
            const theme = document.getElementById('themeFilter').value;
            const year = document.getElementById('yearFilter').value;
            
            console.log('Updating charts with filters:', { theme, year });
            // In a real implementation, this would filter and update chart data
        }
        
        function exportData() {
            // Create and download analytics report
            const dataStr = JSON.stringify(analyticsData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'lego_analytics_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
